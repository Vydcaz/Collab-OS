name: Build SB3 into Website

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Download TurboWarp Packager CLI
        run: |
          mkdir packager
          curl -L -o packager.zip "https://github.com/TurboWarp/packager/releases/latest/download/turbowarp-packager-linux.zip"
          unzip packager.zip -d packager
          chmod +x packager/turbowarp-packager

      - name: Convert SB3 to HTML
        run: |
          mkdir build
          ./packager/turbowarp-packager \
            --input "Col-OS (mistwarp).sb3" \
            --output build/index.html \
            \
            --turbo \
            --framerate 60 \
            --interpolation \
            --hqpen \
            --infinite-clones \
            --remove-fencing \
            --remove-misc-limits \
            \
            --controls pause,fullscreen,greenflag \
            --autostart

      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: build
